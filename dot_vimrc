autocmd!

" Vundle stuff
set nocompatible
filetype off
set rtp+=~/.vim/bundle/vundle/
call vundle#rc()

Bundle 'gmarik/vundle'
Bundle 'wincent/Command-T'
Bundle 'vim-scripts/taglist.vim'
Bundle 'mattn/emmet-vim'
Bundle 'groenewege/vim-less'
Bundle 'mustache/vim-mustache-handlebars'
Bundle 'jtratner/vim-flavored-markdown'
Bundle 'mikewest/vimroom'

" basic settings
filetype plugin indent on
set backspace=eol,indent,start
set directory=~/.vim_backup
set backupdir=~/.vim_backup
set hidden
set hlsearch
set ignorecase smartcase
set incsearch
set shell=/bin/bash\ -i " make shell commands load my bash config
set wildignore=*.pyc,*.o,.git,bower_components,node_modules,__pycache__,venv
let g:CommandTWildIgnore=&wildignore
set wildmenu
set foldopen-=search
set mouse=a
syntax enable
let g:mustache_abbreviations = 1
" disable auto comment insertion on <return>
autocmd FileType * setlocal formatoptions-=c formatoptions-=r formatoptions-=o

" visual customizations
set t_Co=256
set background=dark
colorscheme distinguished
set cursorline
hi CursorLine cterm=NONE ctermfg=NONE ctermbg=235
set showmode
set ruler
set cmdheight=2
set showtabline=2
set scrolloff=3
set winwidth=80
" change cursor when in Normal mode, appears to work only in iTerm2
let &t_SI = "\<Esc>]50;CursorShape=1\x7"
let &t_EI = "\<Esc>]50;CursorShape=0\x7"

" whitespace settings
autocmd BufWritePre * :%s/\s\+$//e " delete trailing whitespace on save
set expandtab
set list listchars=tab:â†’.
set shiftwidth=2
set tabstop=2

" custom mappings
let mapleader=","
command! Q q
map <DOWN> <C-E>
map <UP> <C-Y>
map j gj
map k gk
map * *N
map <C-j> 10j
map <C-k> 10k
map <C-]> g<C-]>

" insert directory part of current file's path in minibuffer. stolen from GRB
cnoremap %% <C-R>=expand('%:h').'/'<cr>

map <leader>< :e ~/.local_vimrc<cr>
map <leader>` :set wrap!<cr>
map <leader>c :%w !pbcopy<CR>
map <leader>f :CommandT<cr>
map <leader>l :set list!<cr>
map <leader>n :e ~/Dropbox/scratch_notes.md<cr>
" in HTML mode, quickly close a tag:
map <leader>/ i</<C-x><C-o><ESC>==

" type-specific configs
autocmd BufNewFile,BufRead *.md setlocal filetype=ghmarkdown
autocmd Filetype ghmarkdown,text setlocal nolist linebreak wrap
autocmd BufNewFile,BufRead local_bash_config setlocal filetype=sh
autocmd Filetype python setlocal shiftwidth=4 tabstop=4

"""""""""""""""""""""""
" test running helpers
""""""""""""""""""""""""
map <leader><c-t> :call SetCurrentTest()<cr>

" Python version of test runner stuff
function! SetCurrentTest()
    let filename = expand('%')
    let stripped = substitute(filename, '.py', '', '')
    let g:CURRENT_TEST = substitute(stripped, '/', '.', 'g')
    echo "Test is now:"
    echo g:CURRENT_TEST
endfunction

" override this with something that includes "<c-r>=expand(g:CURRENT_TEST)<cr>"
" in your local vim settings
map <leader>t :!clear ; python -m unittest discover<cr>

" local configs that aren't saved in the git repo
source ~/.local_vimrc

