autocmd!

""
" Vundle stuff
""
set nocompatible
filetype off
set rtp+=~/.vim/bundle/Vundle.vim
call vundle#begin()

Plugin 'VundleVim/Vundle.vim'
Plugin 'basecase/orgdown'
Plugin 'ctrlpvim/ctrlp.vim'
Plugin 'elixir-lang/vim-elixir'
Plugin 'godlygeek/tabular'
Plugin 'kchmck/vim-coffee-script'
Plugin 'scrooloose/nerdtree'
Plugin 'slim-template/vim-slim.git'
Plugin 'tpope/vim-commentary'
Plugin 'tpope/vim-fugitive'
Plugin 'tpope/vim-rails'

call vundle#end()
filetype plugin indent on

""
" basic settings
""
syntax enable
set backspace=eol,indent,start
set backupdir=~/.vim_backup
set directory=~/.vim_backup
set foldopen-=search "search won't open closed folds on you
set hidden
set hlsearch
set ignorecase smartcase
set incsearch
set lazyredraw
set mouse=a
set nowrapscan "search doesn't wrap at top or bottom of file
set re=1
set shell=/bin/bash\ -i "make shell commands load my bash config
set wildignore=*.pyc,*.o,.git,bower_components,node_modules,__pycache__,venv,dist,tmp
set wildmenu

""
" visual customizations
""
set cmdheight=2
set ruler
set scrolloff=3
set showtabline=2
set t_Co=256
set winwidth=80
set cursorline
set background=dark
highlight CursorLine cterm=NONE ctermfg=NONE ctermbg=235
highlight CursorColumn cterm=NONE ctermfg=NONE ctermbg=235
hi VertSplit ctermbg=8 ctermfg=16

if has("gui_running")
  set background=dark
  colorscheme predawn
  set guifont=Inconsolata:h16
  set showtabline=1
  set guicursor+=a:blinkon0
endif

""
" whitespace settings
""
autocmd BufWritePre * :%s/\s\+$//e " delete trailing whitespace on save
set expandtab
set list listchars=tab:â†’.
set shiftwidth=2
set tabstop=2

""
" custom mappings
""
let mapleader=","
command! Q q
command! W w
map j gj
map k gk
map * *N
map <C-j> 10j
map <C-k> 10k
map <C-]> g<C-]>
map K k
imap <C-d> <C-o>x

map <leader>` :set wrap!<cr>
map <leader>c :%w !pbcopy<CR>
map <leader>j :cnext<cr>
map <leader>k :cprev<cr>
map <leader>l :set list!<cr>
map <leader>n :e ~/Dropbox/scratch_notes.md<cr>
" search for word under point in matching file types and open quickfix with results
map <leader>w yiw:vimgrep <c-r>" **/*.<c-r>=expand('%:e')<cr><cr>:copen<cr>
" convert binary file to a hexdump
map <leader>x :%!xxd<cr>

""
" tab completion: on blank line, <tab> indents, else do completion (stolen from grb)
""
function! InsertTabWrapper()
  let col = col('.') - 1
  if !col || getline('.')[col - 1] !~ '\k'
    return "\<tab>"
  else
    return "\<c-n>"
  endif
endfunction
inoremap <expr> <tab> InsertTabWrapper()
inoremap <s-tab> <c-p>


""
" filetype-specific configs
""
autocmd BufNewFile,BufRead *.md setlocal filetype=orgdown
autocmd BufReadPost quickfix set modifiable
autocmd Filetype c,cpp setlocal shiftwidth=4 tabstop=4
autocmd Filetype eruby setlocal shiftwidth=2 tabstop=2 expandtab
autocmd Filetype orgdown,text setlocal nolist linebreak wrap
autocmd Filetype python setlocal shiftwidth=4 tabstop=4

" Open current file in Marked 2 (does not work without having Marked 2 installed)
command! Marked execute "!open " . expand('%:p') . " -a /Applications/Marked\\ 2.app"

""
" plugin-related settings
""
let g:ctrlp_working_path_mode = 0
let g:ctrlp_match_window = 'max:30'
map <leader>b :CtrlPBuffer<cr>
map <leader>f :CtrlP<cr>
map <leader>z :NERDTreeToggle<cr>
let g:ctrlp_prompt_mappings = {
  \ 'PrtSelectMove("j")': ['<c-j>', '<down>', '<c-n>'],
  \ 'PrtSelectMove("k")': ['<c-k>', '<up>', '<c-p>'],
  \ 'PrtHistory(-1)':       [''],
  \ 'PrtHistory(1)':        [''] }

""
" load untracked local settings
""
source ~/.local_vimrc
